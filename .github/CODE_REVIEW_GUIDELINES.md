# 代码审查指南

## 目标

代码审查的主要目标是：
- 🔍 发现潜在的 bug 和问题
- 📚 知识共享和团队学习
- 🏗️ 确保代码质量和一致性
- 🔒 提高代码安全性
- 📖 改善代码可读性和可维护性

## 审查流程

### 1. 提交前自检

**作者责任：**
- ✅ 运行所有测试并确保通过
- ✅ 运行代码检查工具（ESLint、Flake8）
- ✅ 自我审查代码变更
- ✅ 填写完整的 PR 描述
- ✅ 确保 CI 流水线通过

### 2. 审查分配

- 🎯 至少需要 **1 名审查者** 批准
- 🎯 复杂变更需要 **2 名审查者** 批准
- 🎯 安全相关变更需要 **安全专家** 审查
- 🎯 架构变更需要 **技术负责人** 审查

### 3. 审查时限

- ⏰ **小型 PR**（< 100 行）：24 小时内
- ⏰ **中型 PR**（100-500 行）：48 小时内
- ⏰ **大型 PR**（> 500 行）：72 小时内
- 🚨 **紧急修复**：4 小时内

## 审查重点

### 🔍 功能正确性

- [ ] 代码是否实现了预期功能？
- [ ] 边界条件是否正确处理？
- [ ] 错误处理是否充分？
- [ ] 业务逻辑是否正确？

### 🏗️ 代码设计

- [ ] 代码结构是否清晰？
- [ ] 是否遵循 SOLID 原则？
- [ ] 是否有代码重复？
- [ ] 抽象层次是否合适？
- [ ] 是否遵循现有的架构模式？

### 📖 可读性

- [ ] 变量和函数命名是否清晰？
- [ ] 代码是否易于理解？
- [ ] 复杂逻辑是否有注释？
- [ ] 代码风格是否一致？

### 🚀 性能

- [ ] 是否有性能瓶颈？
- [ ] 数据库查询是否优化？
- [ ] 算法复杂度是否合理？
- [ ] 内存使用是否高效？

### 🔒 安全性

- [ ] 是否有安全漏洞？
- [ ] 输入验证是否充分？
- [ ] 权限检查是否正确？
- [ ] 敏感信息是否泄露？

### 🧪 测试

- [ ] 测试覆盖率是否充分？
- [ ] 测试用例是否有意义？
- [ ] 是否测试了边界条件？
- [ ] 集成测试是否充分？

## 审查最佳实践

### 👥 对于审查者

#### ✅ 应该做的

- **及时响应**：在规定时间内完成审查
- **建设性反馈**：提供具体、可操作的建议
- **解释原因**：说明为什么需要修改
- **认可优秀代码**：对好的实现给予肯定
- **学习态度**：从代码中学习新的技术和方法
- **全面审查**：不仅关注功能，也关注设计和质量

#### ❌ 不应该做的

- **个人攻击**：避免针对个人的负面评论
- **过度挑剔**：不要在风格问题上过分纠结
- **忽略上下文**：理解变更的背景和约束
- **延迟审查**：不要无故拖延审查时间

### 👨‍💻 对于作者

#### ✅ 应该做的

- **积极响应**：及时回应审查意见
- **虚心接受**：以开放的心态接受建议
- **详细解释**：对复杂的设计决策进行说明
- **持续改进**：从审查中学习和成长
- **感谢审查者**：认可审查者的时间和努力

#### ❌ 不应该做的

- **防御性回应**：避免过度为代码辩护
- **忽略建议**：不要无视合理的审查意见
- **匆忙修改**：不要为了快速通过而草率修改

## 审查评论规范

### 🏷️ 评论标签

使用标签来明确评论的性质：

- **🐛 Bug**: 明确的错误或问题
- **💡 Suggestion**: 改进建议
- **❓ Question**: 需要澄清的问题
- **🔧 Nitpick**: 小的风格或格式问题
- **🚨 Critical**: 必须修复的严重问题
- **💭 Thought**: 一般性思考或讨论
- **👍 Praise**: 对优秀代码的认可

### 📝 评论示例

#### ✅ 好的评论

```
🐛 Bug: 这里可能会导致空指针异常
建议在第 15 行添加 null 检查：
if (user && user.email) {
  // 处理逻辑
}
```

```
💡 Suggestion: 考虑使用 Map 而不是 Object
这样可以提高查找性能，特别是当数据量较大时。
参考：https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map
```

```
👍 Praise: 这个错误处理实现得很好！
清晰的错误信息和适当的日志记录。
```

#### ❌ 不好的评论

```
❌ "这段代码很糟糕"
✅ "🔧 Nitpick: 建议将这个长函数拆分为几个小函数，提高可读性"
```

```
❌ "为什么要这样写？"
✅ "❓ Question: 能解释一下选择这种实现方式的原因吗？我想了解设计考虑。"
```

## 特殊情况处理

### 🚨 紧急修复

- 可以先合并，后续补充审查
- 必须在 4 小时内完成事后审查
- 需要在下一个工作日进行回顾

### 🔄 大型重构

- 建议分解为多个小的 PR
- 提前进行设计讨论
- 可能需要多轮审查

### 🆕 新团队成员

- 提供更详细的反馈和解释
- 重点关注代码规范和最佳实践
- 鼓励提问和学习

## 工具和自动化

### 🤖 自动化检查

- **代码格式化**: Prettier, Black
- **代码检查**: ESLint, Flake8
- **测试覆盖率**: Jest, pytest-cov
- **安全扫描**: Snyk, Safety
- **依赖检查**: npm audit, safety

### 📊 度量指标

跟踪以下指标来改进审查流程：

- 审查响应时间
- 审查完成时间
- 发现的问题数量
- 审查后的 bug 率
- 团队满意度

## 持续改进

### 📈 定期回顾

- **每月团队回顾**：讨论审查流程的改进
- **季度指标分析**：分析审查效果和趋势
- **年度流程优化**：根据团队成长调整流程

### 📚 学习资源

- [Google 代码审查指南](https://google.github.io/eng-practices/review/)
- [Atlassian 代码审查最佳实践](https://www.atlassian.com/agile/software-development/code-reviews)
- [Microsoft 代码审查清单](https://docs.microsoft.com/en-us/azure/devops/repos/git/pull-request-checklist)

---

**记住：代码审查不仅是为了发现问题，更是团队学习和成长的机会！** 🚀