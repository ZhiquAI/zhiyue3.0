> **说明**：本文档依据《在线考试阅卷完整工作流程图》，对智阅阅卷系统的核心模块进行重新梳理，旨在帮助产品、研发及项目管理人员快速理解系统边界、功能分工与交互流程。

---

## 模块总览

| 序号 | 模块 | 角色主要关注点 | 与上下游的关键接口 |
| ---- | ---- | -------------- | ------------------- |
| 1 | 工作台 Workbench | 任务提醒 / 数据概览 | 与所有业务模块拉取统计数据 |
| 2 | 考务管理 Exam Management | 考试建档 / 学生&考场编排 / 模板设计 | 向条码生成、阅卷中心提供考试基础数据 |
| 3 | 采集与识别 Capture & OCR | 图像上传 / 校正 / 切割 / OCR/OMR | 调用模板 & 学生信息，产出切割结果 |
| 4 | 阅卷中心 Grading Center | AI预评分 / 教师审核 / 仲裁 | 读取切割图片与OCR文本，写入成绩表 |
| 5 | 数据分析 Data Analytics | 成绩聚合 / 诊断报告 / 可视化 | 消费成绩数据，生成报告并推送工作台 |
| 6 | 系统管理 System Admin | 用户/角色/权限 / 参数配置 | 为各业务模块提供统一鉴权与配置 |

> **核心流程概述**：考务管理→条码生成→答题卡扫描→采集与识别→AI预评卷→教师/仲裁→成绩入库→数据分析→报告发布。

---

## 1. 工作台（Workbench）

### 1.1 定位
登录后的默认首页，聚合展示与当前用户角色相关的任务、数据及快捷入口，强调“代办 + 数据洞察”双重价值。

### 1.2 功能明细
- **任务提醒**：待阅卷量、待发布报告数、系统公告等，实时轮询或 WebSocket 推送。
- **数据概览**：
  - 教师：所教班级平均分走势、错题热点。
  - 管理员：全校考试进度、阅卷效率、异常监控。
- **快捷入口**：创建考试、进入阅卷中心、下载报告等，一键直达。

---

## 2. 考务管理（Exam Management）

### 2.1 考试生命周期
| 状态 | 关键动作 | 说明 |
| ---- | -------- | ---- |
| 草稿 | 创建考试，录入基本信息 | 支持复制历史考试快速新建 |
| 准备中 | 导入学生、设计模板、生成条码 | 完成后可锁定，进入扫码阶段 |
| 阅卷中 | 扫描答题卡，开启阅卷中心 | 创建后不可再修改模板 |
| 已结束 | 成绩发布，进入归档 | 数据只读，供查询与分析 |

### 2.2 学生与考场编排
- **批量导入**：标准模板 + 实时校验（重复学号、缺字段）。
- **考场分配**：支持班级顺序、随机打乱、S/Z 形排座。
- **准考证号规则**：可自定义前缀、递增位数，保证唯一性。

### 2.3 答题卡模板设计
- 画布操作：底图上传、缩放、标尺对齐。
- 区域类型：定位点、条码区、客观题矩阵、主观题区域。
- 版本控制：模板保存为 JSON，支持历史版本回滚。

#### 2.3.1 区域功能与技术参数
| 区域 | 坐标示例(px) | 规格 | 识别要求 | 结果映射 |
| ---- | ----------- | ---- | -------- | -------- |
| 定位角点 | (30,30)(5656,30)… | 4×4 mm 黑色方块 | 允许≤1 ° 倾斜 | 图像校正基准 |
| 学生信息区 | (320,180)–(1750,440) | 14 pt OCR-B | ≥97% 字符准确率 | 学生表 → student_id |
| 条形码区 | (1830,180)–(2250,440) | Code128、15 mil | ECC ≥20% | exam_id + sheet_no |
| 客观题矩阵 | (190,600)–(1750,2050) | 10×40 填涂框 | SNR≥8dB | answer_items[] |
| 主观题答题区 | (1950,600)–(5650,2050) | 27 行横线 | 分辨率≥300 dpi | answer_images[] |

> **注意**：模板以 300 dpi、A4 纵向为基准，扫描端需保持同分辨率；若使用 200 dpi 扫描，将按比例缩放坐标。

#### 2.3.2 标记编码规范
```jsonc
{
  "sheet_type": "history_junior",
  "version": "2025.3",
  "regions": [
    {"id": "anchor_tl", "type": "anchor", "x":30, "y":30},
    {"id": "barcode", "type": "barcode", "format":"Code128", "x":1830, "y":180, "w":420, "h":260},
    {"id": "choice_grid", "type": "omr", "rows":10, "cols":40, "x":190, "y":600, "w":1560, "h":1450},
    {"id": "essay_area", "type": "subjective", "lines":27, "x":1950, "y":600, "w":3700, "h":1450}
  ]
}
```

### 2.4 考前物料
- 条码批量生成 → PDF 排版 → 下载打印。
- 模板导出：提供二维码，供扫描端快速加载模板。

---

## 3. 采集与识别（Capture & OCR）

### 3.1 扫描上传
- 支持高速扫描仪批量上传；文件夹监听 + API 双通道。
- 自动重命名：按扫描顺序生成流水号，防止重名。

### 3.2 图像预处理
- 倾斜校正、透视变换、噪声去除。
- 定位点校验：若偏差超阈值，标记为异常待人工复检。

### 3.3 切割 & 识别
- **条码区**：OCR → 学生匹配。
- **客观题区**：OMR → 选项结果。
- **主观题区**：裁剪子图 → OCR 文本化，为 AI 评分做准备。

---

## 4. 阅卷中心（Grading Center）

> **目标**：在保证准确率前提下，将单卷处理 P95 压缩至 8 秒内；通过 AI+人工双评一致率 99.5% 的质量监控体系，将异常漏判率控制在 0.2% 以内。

| 子模块 | 关键职责 | 性能&可用性要点 | 交互对象 |
| ------ | -------- | -------------- | -------- |
| **4.1 批次管理** | 创建批次、进度跟踪、权限隔离 | 批次状态实时推送；支持灰度/回滚 | 上传中心、质量监控 |
| **4.2 上传中心** | 扫描上传、条码校验、进度可视 | 流式切片边传边入队；MinIO + CDN 热备 | 预处理服务、批次管理 |
| **4.3 预处理服务** | OCR/OMR、切片、质检 | GPU/CPU 混合调度；故障实例自动迁移 | 判分中心、异常工单 |
| **4.4 判分中心** | 客观题判分、AI 主观判分、人工复核 | Worker AutoScale；Dispatcher 动态分流 | 质量监控、仲裁 |
| **4.5 质量监控** | 双评抽检、指标看板、报警 | Prometheus + Grafana；WebSocket 实时 diff | 异常工单、成绩汇总 |
| **4.6 异常工单** | 自动工单、重跑、日志聚合 | SLA 驱动升级；Loki 日志链路溯源 | 判分中心、质量监控 |
| **4.7 成绩汇总** | 分数合成、异常标记、导出 API | Redis Stream + BullMQ 保证顺序；多格式导出 | 数据分析、工作台 |

### 4.1 批次管理
- **批次仪表盘**：队列长度、处理速率、异常率三色预警。
- **权限隔离**：按考试/学科分区，避免数据串扰。

### 4.2 上传中心
- **流式切片上传**：文件分块直写 MinIO，同时推事件至 `upload_stream`，平均等待减少 45%。
- **条码即验**：边上传边校验 sheet_no 重复，立即回馈扫描端。

### 4.3 预处理服务
- **多实例 GPU 池**：OCR 任务自动分配 GPU，OMR 走 CPU，资源利用率提高 30%。
- **质检策略**：倾斜度 >5° 或分辨率 <250 dpi 自动标记异常并推送工单。

### 4.4 判分中心
- **Dispatcher**：按题型+置信度路由至 AI、人工或双评。
- **动态阈值**：基于最近 1h 模型漂移指标自动调整置信度门限。

### 4.5 质量监控
- **抽检引擎**：支持随机、难度、异常分布多维规则；抽检结果进入指标看板。
- **实时 diff**：AI 分 vs 人工分差值 > 阈值高亮，点击直达工单。

### 4.6 异常工单
- **SLO 升级**：5 分钟未处理自动升级负责人并短信告警。
- **一键重跑**：引用原始切片重新触发预处理→判分流水线。

### 4.7 成绩汇总
- **分布式锁**：同一学生多卷并发时合成分数保证幂等。
- **增量推送**：使用 SSE 将判分进度实时推送前端。

> **高可用设计**：所有核心服务以 K8s Deployment + HPA 部署，Replica ≥3；消息链路基于 Redis Stream 集群主从；MinIO+Erasure Code 提供 12 nines 数据耐久性；Prom + Alertmanager 覆盖 CPU/GPU/队列积压等 30+ 指标。

> **扩展性设计**：AI 推理层采用 gRPC 多模型网关，可热插拔引擎；前端使用 Module Federation，阅卷、监控、工单子应用独立部署升级。

---

## 5. 数据分析（Data Analytics）

### 5.1 宏观报告
- 班级/年级平均分、最高分、分布区间、及格率。
- 题目项目分析：得分率、难度、区分度。

### 5.2 微观诊断
- 知识图谱映射：学生掌握 / 薄弱 / 待巩固知识点。
- 个性化建议：NLG 生成学习方案 + 推荐资源。

### 5.3 发布与权限
- 审核后“一键发布”，自动推送至工作台。
- 角色粒度权限：教师看班级，学生/家长看个人。

---

## 6. 系统管理（System Admin）

- 用户、角色与权限：RBAC 模型，支持 LDAP / SSO 对接。
- 基础配置：评分阈值、扫描路径、AI 模型版本。
- 日志与监控：接口日志、模型调用日志、系统健康检查。

---

## 7. 模块间数据流

```mermaid
flowchart LR
    A[考务管理] -- 考试ID/模板 → B[采集识别]
    B -- 切割图片/OCR → C[阅卷中心]
    C -- 成绩明细 → D[数据分析]
    D -- 报告 & 指标 → E[工作台]
```

> **实施建议**：先快速落地“考务管理 + 采集识别 + 基础阅卷”闭环，在真实数据中打磨 AI 评分与数据分析，后续逐步迭代高级功能（仲裁、知识图谱、NLG 报告）。
