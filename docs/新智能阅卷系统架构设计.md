# 智阅AI v4.0 - 新智能阅卷系统架构设计

## 🎯 设计目标
- 简洁高效的智能阅卷流程
- 模块化可扩展架构
- 用户友好的API设计
- 快速响应和高性能处理

## 📋 核心功能模块

### 1. 文件处理模块 (FileProcessor)
**职责：** 处理答题卡图像文件的上传、预处理和格式转换
- 文件上传和验证
- 图像质量检测和优化
- 格式标准化
- 批量处理支持

### 2. OCR识别模块 (OCREngine)
**职责：** 提取答题卡上的文字和内容
- 学生信息识别（姓名、学号等）
- 答案内容提取
- 条码识别（如有）
- 置信度评估

### 3. 智能评分模块 (SmartGrading)
**职责：** 基于AI的答案评分和分析
- 客观题自动评分
- 主观题智能评分
- 评分标准应用
- 结果置信度计算

### 4. 质量控制模块 (QualityControl)
**职责：** 确保阅卷质量和结果可靠性
- 结果审核和验证
- 异常检测
- 置信度分析
- 人工复核建议

### 5. 结果管理模块 (ResultManager)
**职责：** 管理阅卷结果和报告生成
- 结果存储和检索
- 统计分析
- 报告生成
- 数据导出

## 🏗️ 系统架构层次

```
┌─────────────────────────────────────────────────────────┐
│                    前端用户界面                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │ 快速阅卷    │  │ 批量管理    │  │ 结果分析    │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────┐
│                    API 网关层                            │
│           智能阅卷 REST API v4.0                         │
└─────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────┐
│                    业务逻辑层                            │
│  ┌───────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐ │
│  │FileProcess│  │OCREngine │  │SmartGrade│  │Quality  │ │
│  │           │  │          │  │          │  │Control  │ │
│  └───────────┘  └──────────┘  └──────────┘  └─────────┘ │
│  ┌───────────┐                                          │
│  │ResultMgr  │                                          │
│  └───────────┘                                          │
└─────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────┐
│                    数据存储层                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │   文件存储   │  │  数据库存储  │  │   缓存存储   │      │
│  │    Files    │  │  Database   │  │    Cache    │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────┘
```

## 📊 数据模型设计

### GradingTask (阅卷任务)
```python
class GradingTask:
    id: str
    name: str
    created_at: datetime
    status: GradingStatus  # pending, processing, completed, failed
    file_count: int
    processed_count: int
    success_count: int
    config: GradingConfig
```

### AnswerSheet (答题卡)
```python
class AnswerSheet:
    id: str
    task_id: str
    file_path: str
    student_info: StudentInfo
    answers: List[Answer]
    scores: List[Score]
    quality_metrics: QualityMetrics
    status: ProcessStatus
```

### GradingResult (阅卷结果)
```python
class GradingResult:
    answer_sheet_id: str
    total_score: float
    question_scores: Dict[str, float]
    confidence: float
    needs_review: bool
    review_reasons: List[str]
```

## 🔄 处理流程设计

### 智能阅卷处理流程
1. **文件上传** → 验证文件格式和大小
2. **任务创建** → 生成阅卷任务记录
3. **文件预处理** → 图像质量优化和标准化
4. **OCR识别** → 提取学生信息和答案内容
5. **智能评分** → AI评分和置信度计算
6. **质量控制** → 结果验证和异常检测
7. **结果汇总** → 生成最终评分报告
8. **状态更新** → 更新任务状态和通知用户

### API 端点设计

#### 核心API端点
- `POST /api/v4/grading/tasks` - 创建阅卷任务
- `GET /api/v4/grading/tasks/{task_id}` - 获取任务状态
- `GET /api/v4/grading/tasks/{task_id}/results` - 获取阅卷结果
- `POST /api/v4/grading/upload` - 上传答题卡文件
- `POST /api/v4/grading/process` - 开始处理
- `GET /api/v4/grading/system/status` - 系统状态

#### 管理API端点
- `GET /api/v4/grading/tasks` - 任务列表
- `DELETE /api/v4/grading/tasks/{task_id}` - 删除任务
- `POST /api/v4/grading/tasks/{task_id}/retry` - 重试处理
- `GET /api/v4/grading/stats` - 系统统计

## 🎨 前端界面设计

### 主要页面组件
1. **快速阅卷面板** - 拖拽上传，一键处理
2. **任务管理页面** - 任务列表和状态监控
3. **结果查看页面** - 详细结果和分析报告
4. **系统设置页面** - 阅卷参数配置

### 交互流程设计
1. 用户拖拽上传答题卡文件
2. 系统显示文件预览和基本信息
3. 用户点击"开始智能阅卷"
4. 实时显示处理进度和状态
5. 完成后展示结果概览
6. 提供详细结果查看和导出功能

## 🔧 技术选型

### 后端技术
- **框架：** FastAPI (保持一致)
- **数据库：** SQLite/PostgreSQL
- **文件存储：** 本地存储 + 对象存储支持
- **缓存：** Redis (可选)
- **OCR引擎：** Gemini Vision API
- **队列：** 内置异步任务队列

### 前端技术
- **框架：** React 18 + TypeScript (保持一致)
- **UI组件：** Ant Design (保持一致)
- **状态管理：** React Hooks
- **文件上传：** Ant Design Upload + 拖拽支持
- **数据可视化：** Charts.js / ECharts

## 🚀 性能优化策略

### 处理性能
- 异步批量处理
- 图像预处理优化
- 并发OCR识别
- 智能缓存策略

### 用户体验
- 实时进度反馈
- 渐进式结果展示
- 响应式设计
- 快速错误恢复

## 📈 扩展性设计

### 模块扩展
- 插件式评分算法
- 自定义OCR引擎
- 多种文件格式支持
- 多语言支持

### 集成能力
- 第三方OCR服务
- 外部存储系统
- 学校管理系统
- 成绩导出系统

---

## 📅 实施计划

### 阶段一：核心模块开发
1. 建立基础架构
2. 实现文件处理模块
3. 集成OCR识别功能
4. 基础API端点开发

### 阶段二：智能评分功能
1. 智能评分模块开发
2. 质量控制机制
3. 结果管理功能
4. 前端界面开发

### 阶段三：优化和完善
1. 性能优化
2. 用户体验改进
3. 错误处理完善
4. 文档和测试

这个新架构将更加简洁、高效，专注于核心的智能阅卷功能，同时保持良好的扩展性和维护性。